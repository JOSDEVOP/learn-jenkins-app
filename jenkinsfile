pipeline{
    
    agent any
    stages{
         
        stage('Build'){
           
            agent{
                docker{
                    image 'node:18-alpine'
                    args '-u root'
                    reuseNode true
                }
            }
          
            steps{
                
            cleanWs()
          
                sh'''
                pwd
                ls -la
                npm --version
                node --version
                npm ci
                npm run build
                ls -la
                
                '''
                
            }
        }
        stage('Test'){
            agent{
                docker{
                    image 'node:18-alpine'
                    reuseNode true
                
                } 
                

            }
                steps{
                      sh'''
                    test  -f  build/index.html
                    npm test

                '''
                archiveArtifacts artifacts:'test-results/**'
                }
            
        }
        
        
    }
 
    post{
success{

    archiveArtifacts artifacts: 'build/**'
}

    }
  
}


