// pipeline{
    
//     agent any
//     stages{
         
//         stage('Build'){
           
//             agent{
//                 docker{
//                     image 'node:18-alpine'
//                     // args '-u root'
//                     reuseNode true
//                 }
//             }
          
//             steps{
                
//             //   cleanWs()
          
//                 sh'''
//                 pwd
//                 ls -la
//                 npm --version
//                 node --version
//                 npm ci
//                 npm run build
//                 ls -la
                
//                 '''
                
//             }
//         }
//         stage('Test'){
//             agent{
//                 docker{
//                     image 'node:18-alpine'
//                     reuseNode true
            
//                 } 
                

//             }
//                 steps{
//                       sh'''
//                     test  -f  build/index.html
//                     npm test

//                 '''
//                 archiveArtifacts artifacts:'test-results/**'
//                 }
            
//         }
//         stage('E2E'){
//             agent{
//                 docker{
//                     image 'mcr.microsoft.com/playwright:v1.46.1-jammy'
//                     reuseNode true
//                     // args' -u root'
            
//                 } 
                

//             }
//                 steps{
//                       sh'''
//                       npm install   serve
//                       node_modules/.bin/serve -s build
//                       npx playwright test

//                 '''
      
//                 }
            
//         }
        
        
//     }
 
//     post{
// success{

//     archiveArtifacts artifacts: 'build/**'
// }

//     }
  
// }

pipeline {
    agent any

    stages {
  

        stage('Build') {
            agent {
                docker {
                    image 'node:18-alpine'
                    reuseNode true
                   
                }
            }
            steps {
                sh '''
                 rm -f  /var/lib/jenkins/workspace/Jibril Salim Osman
                    
                    npm cache clean --force

                    ls -la
                    node --version
                    npm --version
                    npm ci
                    npm run build
                    ls -la
                '''
            }
        }
   

        stage('Test') {
            agent {
                docker {
                    image 'node:18-alpine'
                    reuseNode true
                }
            }

            steps {
                sh '''
                    #test -f build/index.html
                    npm test
                '''
            }
        }

        stage('E2E') {
            agent {
                docker {
                    image 'mcr.microsoft.com/playwright:v1.39.0-jammy'
                    reuseNode true
                }
            }

            steps {
                sh '''
                    npm install serve
                    node_modules/.bin/serve -s build &
                    sleep 10
                    npx playwright test
                '''
            }
        }
    }

    post {
        always {
            junit 'jest-results/junit.xml'
        }
    }
}

